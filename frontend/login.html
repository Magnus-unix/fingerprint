<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>登录</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="login-container">
      <h2>登录系统</h2>
      
      <div id="loginResult" style="color: red; margin-bottom: 1rem;"></div>
      
      <input type="text" id="username" placeholder="用户名" required>
      <input type="password" id="password" placeholder="密码" required>
      <button id="loginButton">登录</button>
      
      <p>没有账号？<a href="register.html">点击注册</a></p>
  </div>

  <script type="module">
      import { getFingerprint } from "./js/fingerprint.js";

      document.getElementById('loginButton').addEventListener('click', async () => {
          const username = document.getElementById('username').value.trim();
          const password = document.getElementById('password').value.trim();

          if (!username || !password) {
              document.getElementById('loginResult').innerText = "用户名和密码不能为空";
              return;
          }

          const fingerprint = await getFingerprint(username);

          const response = await fetch('http://123.123.123.123:8080/login', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ username, password, fingerprint })
          });

          const result = await response.json();
          if (result.success) {
              document.getElementById('loginResult').style.color = 'green';
              document.getElementById('loginResult').innerText = '登录成功，即将跳转...';
              setTimeout(() => {
                  window.location.href = 'test.html';  // 静态跳转
              }, 1000);
          } else {
              document.getElementById('loginResult').style.color = 'red';
              document.getElementById('loginResult').innerText = result.message;
          }
      });
  </script>
</body>
</html>
